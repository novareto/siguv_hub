[buildout]
extends = 
parts = mkdirs who_ini deploy_ini omelette instance app
extensions = mr.developer
eggs-directory = ./eggs
find-links = http://pypi.dolmen-project.org/find-links
versions = versions

# mr.developer
always-checkout = false 
auto-checkout = *
sources = sources
sources-dir = checkouts

[sources]
wsgiproxy = git https://github.com/whitmo/WSGIProxy.git
uvc.concierge = git git@github.com:novareto/uvc.concierge.git

[versions]
Beaker = 1.8.1

[omelette]
recipe = collective.recipe.omelette
eggs = ${app:eggs}


[settings]
confdir = ${buildout:directory}/conf
session_cache = ${buildout:directory}/session_cache
datadir = ${buildout:directory}/data
cachedir = ${buildout:parts-directory}/cache
logfiles = ${buildout:directory}/var/log
loglevel = INFO
host = 0.0.0.0
port = 7080


[app]
recipe = zc.recipe.egg
eggs = 
     paste
     Paste
     PasteDeploy
     PasteScript
     diazo
     repoze.xmliter
     uvc.concierge
     repoze.who
     gunicorn
     beaker
     beaker_redis

[mkdirs]
recipe = z3c.recipe.mkdir
paths =
    ${settings:confdir}


[deploy_ini]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/deploy.ini.in
output = ${settings:confdir}/deploy.ini


[who_ini]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/who.ini.in
output = ${settings:confdir}/who.ini


[instance]
recipe = collective.recipe.scriptgen
cmd = ${buildout:bin-directory}/paster
arguments = serve ${deploy_ini:output} 


[uwsgi]
recipe = buildout.recipe.uwsgi
config-socket = ${settings:host}:${settings:port}
config-protocol = http
config-master = True
config-route = ^/favicon.ico break:404 Not Found
config-single-interpreter = True
config-processes = 4
config-cpu-affinity = 4
config-max-requests = 2000
config-no-orphans = True
eggs = uwsgi
       barrel
       uvc.concierge
       fanstatic
       Paste
       PasteScript
       PasteDeploy
